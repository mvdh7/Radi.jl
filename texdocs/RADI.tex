\documentclass[a4paper]{article}
\usepackage{siunitx}
\usepackage{natbib}
\bibliographystyle{abbrvnat}
\usepackage[version=4]{mhchem}
\usepackage[dvipsnames]{xcolor}
\usepackage{amsmath}

\newcommand{\D}[1]{\mathrm{d}#1}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\uM}{\si{\micro}\mathrm{M}}
\newcommand{\molmmm}{\mathrm{mol}\cdot\mathrm{m}^{-3}}
\newcommand{\degC}{\si{\degree}\mathrm{C}}
\newcommand{\wtf}[1]{\textcolor{Cerulean}{\textbf{#1}}}
\newcommand{\codenote}[1]{\textcolor{Orange}{\textbf{#1}}}

\begin{document}

\title{RADI.jl}
\author{Olivier Sulpis and Matthew P. Humphreys}

\maketitle

\begin{abstract}
RADI.jl is a Julia implementation of RADI: the 1-D Reaction-Advection-Diffusion-Irrigation Diagenetic Sediment Module \wtf{(Q1: is there already a citation for RADI?)}. Here, we define the variables and the equations used in this implementation. So far, only one solute (dissolved oxygen) and one solid (particulate organic carbon) are included and documented here. This document focuses on the mathematics of the model and this specific implementation in Julia. It is not intended to explain the underlying science.
\end{abstract}

\section{Parameters}

\subsection{Time}

Time units are always in years.
\begin{itemize}
  \item $T$ ($\code{stoptime}$ in a) is the total time that the model runs for.
  \item $\D{t}$ ($\code{interval}$ in a) is the time resolution (i.e. the interval between each timestep).
  \item $t$ ($\code{timesteps}$ in a) refers to the array of modelled timepoints.
\end{itemize}
The model therefore runs from time $0$ to $T$ in intervals of $\D{t}$.

\subsection{Sediments and porewaters}

\subsubsection{Structure}

Depth units are always in metres.
\begin{itemize}
  \item $Z$ ($\code{z\_max}$ in m) is the total height of the sediment column being modelled.
  \item $\D{z}$ ($\code{z\_res}$ in m) is the depth resolution (i.e. the height of each model layer).
  \item $z$ ($\code{depths}$ in m) refers to the array of modelled depths within the sediment.
\end{itemize}
The model layers are therefore at depths within the sediment from $0$ to $Z$ in increments of $\D{z}$, where $0$ represents the interface between the surface sediment and overlying seawater.

\subsubsection{Overlying water}

Properties of the overlying water can be set by the user:

\begin{itemize}
  \item $[\ce{O2}]_w$ ($\code{oxy\_w}$ in $\molmmm$) is the seawater dissolved oxygen concentration.
  \item $F_c$ ($\code{Foc}$ in mol$\cdot$m$^{-1}\cdot$a$^{-1}$) is the flux of particulate organic carbon arriving at the seafloor.
  \item $\delta$ ($\code{dbl}$ in m) is the diffusive boundary layer thickness.
  \item $T_w$ ($\code{T}$ in $\degC$) is the water temperature.
\end{itemize}
\codenote{Note that $T$ is also used for the total model runtime...}

\subsubsection{Sediment properties}

In the current set-up of RADI.jl, the porosity parameters $\phi_\infty$ and $\phi_0$ are set to 0.74 and 0.85 respectively ($\code{phiInf}$ and $\code{phi0}$, both dimensionless), and $\beta = 33$ m$^{-1}$ ($\code{beta}$). These values were obtained by fitting real data from station 7, mooring 3 of cruise NBP98-2 \citep{sayles_benthic_2001}. \wtf{Q2: Should these ($\phi_0$, $\phi_\infty$ and $\beta$) be inputs that the user can easily adjust?}

The porosity profile ($\phi$, $\code{phi}$, dimensionless) is parameterised following \citet{boudreau_method--lines_1996}:
\begin{equation}\label{phi}
\phi = \phi_\infty + (\phi_0 - \phi_\infty) \exp(-\beta z)
\end{equation}
The corresponding ``solid porosity'' ($\phi_s$, $\code{phiS}$, dimensionless) is:
\begin{equation}\label{phiS}
\phi_s = 1 - \phi
\end{equation}
RADI.jl also uses the related convenience variable $\code{phiS\_phi} = \phi_s/\phi$.

Following \citet{boudreau_diffusive_1996}, the sediment tortuosity ($\theta$, $\code{tort}$, dimensionless) is:
\begin{equation}\label{tort}
\theta = \sqrt{1 - 2 \log \phi}
\end{equation}
RADI.jl also uses the related convenience variable $\code{tort2} = \theta^2$.

Following \citet{archer_model_2002}, the surface sediment bioturbation coefficient $B_0$ ($\code{D\_bio\_0}$ in m$^2\cdot$a$^{-1}$) is:
\begin{equation}\label{D_bio_0}
B_0 = (0.0232 \cdot 10^{-4}) (F_c \cdot 10^2)^{\,0.85}
\end{equation}
\wtf{Q3: Eq. \eqref{D_bio_0}: where do the $10^{-4}$ and $10^2$ multipliers come from? Are they just unit conversions?}

The bioturbation coefficient propagates down through the sediment as $B_z$ ($\code{D\_bio}$ in m$^2\cdot$a$^{-1}$):
\begin{equation}\label{B_z}
B_z = B_0 \exp(-z/\lambda_b) [\ce{O2}]_w / ([\ce{O2}]_w + 0.02 \, \molmmm)
\end{equation}
where $\lambda_b$ ($\code{lambda\_b}$ in m) is the characteristic depth of 0.08 m, following \citet{sayles_benthic_2001}. \wtf{Q4: Where does the magic 0.02 number come from?}

The rate constant for organic matter degradation ($k_z$, $\code{krefractory}$ in a$^{-1}$) is \citep{archer_model_2002}:
\begin{equation}\label{k_poc_degradation}
k_z = 80.25 \, B_0 \exp(-z)
\end{equation}

\section{Variables}

\subsection{Porewater solutes}

Within the sediment porewaters:
\begin{itemize}
  \item $[\ce{O2}]$ (\code{oxy} in $\molmmm$) is the dissolved oxygen concentration.
\end{itemize}

\subsection{Solids}

Within the sediment itself:
\begin{itemize}
  \item $[$POC$]$ (\code{poc} in $\molmmm$) is the particulate organic carbon concentration.
\end{itemize}

\section{Master equation}

For each modelled variable $v$ at time $t$ and depth $z$:
\begin{equation}
v_{(t+\D{t}), z} = v_{t,z} + [R(v_{t,z}) + A(v_{t,z}) + D(v_{t,z}) + I(v_{t,z})] \cdot \D{t}
\end{equation}
where:
\begin{itemize}
  \item $R(v_{t,z})$ quantifies the rate of change of $v_{t,z}$ due to \textbf{reactions} (section \ref{sx:reaction}).
  \item $A(v_{t,z})$ quantifies the rate of change of $v_{t,z}$ due to \textbf{advection} (section \ref{sx:advection}).
  \item $D(v_{t,z})$ quantifies the rate of change of $v_{t,z}$ due to \textbf{diffusion} (section \ref{sx:diffusion}).
  \item $I(v_{t,z})$ quantifies the rate of change of $v_{t,z}$ due to \textbf{irrigation} (section \ref{sx:irrigation}).
\end{itemize}
In the subsequent sections, only the subscript $z$'s are explicitly written out; the $t$'s are excluded, for clarity.

\section{Reaction}\label{sx:reaction}

Biogeochemical reactions operate on solutes and solids throughout the entire sediment column, including the very top and bottom layers. $R(v_t)$ is the net rate at which $v$ is being consumed (negative $R$) or created (positive $R$) by these reactions.

\subsection{Organic matter degradation}

Organic matter degradation affects dissolved oxygen and particulate organic carbon:
\begin{equation}
R(\mathrm{POC}) = -k_z [\mathrm{POC}]
\end{equation}
\begin{equation}\label{r_O2}
R(\ce{O2}) = r(\mathrm{POC}) \cdot \phi_s / \phi
\end{equation}
where the rate constant $k_z$ was defined in Eq. \eqref{k_poc_degradation}, and porosity coefficients $\phi$ and $\phi_s$ in Eqs. \eqref{phi} and \eqref{phiS} respectively. \wtf{Q5: Eq. \eqref{r_O2}: should there not be a photosynthetic quotient (C:O$_2$ ratio) in here?}

\section{Advection}\label{sx:advection}.

\wtf{Q6: By "advection" do we mean things literally moving around within a static sediment (i.e. porewater is advecting relative to the centre of the Earth), or is it that things to move relatively speaking because the sediment surface moves up as new material settles onto it (i.e. porewater is static relative to the centre of the Earth, but advecting relative to the sediment-water interface)?}

Advection is modelled differently (1) at the sediment-water interface (i.e. where $z = 0$), (2) within the sediment ($0 < z < Z$), and (3) at the bottom of the sediment ($z = Z$).

\subsection{Advection at the sediment-water interface}\label{sx:adv_swi}

At sediment depth $z = 0$ only, for solutes (e.g. $\ce{O2}$):
\begin{equation}
A(v_0) = u_0 (v_w - v_0) \theta^2 / \delta
\end{equation}
and for solids (e.g. POC):
\begin{equation}
A(v_0) = w_0 (F_c - \phi_s w_0 v_0) / (B_0 \phi_s)
\end{equation}

\subsection{Advection within the sediment}

At sediment depth $z$, where $0 < z < Z$, for solutes (e.g. $\ce{O2}$):
\begin{equation}
A(v_z) = -[u_z - (\theta^2 \D{\phi} / \phi - \D{\{\theta^2\}}) d(v_z) / \theta^2] [v_{(z+\D{z})} - v_{(z-\D{z})}] / 2 \D{z}
\end{equation}
where $d(v_z)$ is the relevant diffusion coefficient given in section \ref{sx:diffusion}.

For solids (e.g. POC):
\begin{equation}
\begin{split}
A(v_z) = & -[(1 - \sigma_z) v_{(z+\D{z})} + 2 \sigma_z v_z - (1 + \sigma_z) v_{(z-\D{z})}] \cdot \\
& [w_z - \D{B_z} - \D{\phi_s} B_z / \phi_s] / 2 \D{z}
\end{split}
\end{equation}
where $\sigma_z$ ($\code{sigma}$) is given by:
\begin{equation}
\sigma_z = 1 / \mathrm{tanh}(P_{e_h}) - 1 / P_{e_h}
\end{equation}
in which $P_{e_h}$ ($\code{Peh}$) is:
\begin{equation}
P_{e_h} = w_z \D{z} / (2 B_z)
\end{equation}

\subsection{Advection at the bottom of the sediment}\label{sx:adv_bot}

Solutes (e.g. \ce{O2}) are not affected by advection at the bottom of the sediment.

At sediment depth $z = Z$ only, and for solids only (e.g. POC):
\begin{equation}
A(v_Z) = -(w_Z - \D{B_Z} - \D{\phi_s} B_Z / \phi_s) (v_Z - v_{(Z-\D{z})}) \sigma_Z / \D{z}
\end{equation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% D I F F U S I O N %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Diffusion}\label{sx:diffusion}

\subsection{Effective diffusion coefficients}

Diffusion is controlled by each variable's effective diffusion coefficient, which varies with depth in the sediment (generically denoted $d_z(v)$ for variable $v$, $\code{D\_var}$, always in m$^2\cdot$a$^{-1}$).

\subsubsection{Effective diffusion coefficients for solutes}

Each solute has a "free-solution" molecular/ionic diffusion coefficient $d^\circ(v)$, which can be estimated from temperature, salinity and pressure. For dissolved oxygen, following \citet{li_diffusion_1974}:
\begin{equation}
d^\circ(\ce{O2}) = 0.034862 + 0.001409 T_\mathrm{w}
\end{equation}

The $d^\circ(v)$ can be converted into the $d_z(v)$ required by RADI following \citet{boudreau_method--lines_1996}:
\begin{equation}
d_z(v) = \frac{d^\circ(v)}{(\theta_z)^2}
\end{equation}

\subsubsection{Effective diffusion coefficients for solids}

For particulate organic carbon:
\begin{equation}
d_z(\mathrm{POC}) = b_z
\end{equation}

\subsection{Diffusion within the sediment}

At sediment depth $z$, where $0 < z < Z$, for both solutes and solids:
\begin{equation}\label{eq:diffusion}
D(v_z) = d_z(v) \cdot \big( v_{(z-\D{z})} - 2 v_z + v_{(z+\D{z})} \big) / (\D{z})^2
\end{equation}
where $d_z(v)$ is the relevant diffusion coefficient.

\subsection{Diffusion at the sediment-water interface}\label{sx:diffusion_surface}

At sediment depth $z = 0$ only, $v_{(z-\D{z})} = v_{(-\D{z})}$ is invalid as it represents a value in the water above the sediment surface. We therefore calculate diffusion at $z = 0$ using \eqref{eq:diffusion} after making the following substitutions for solutes:
\begin{equation}\label{Dv0}
v_{(-\D{z})} = v_{\D{z}} + \frac{2 \D{z}}{\delta \phi_0^{(n+1)}} (v_\mathrm{w} - v_0)
\end{equation}
and for solids:
\begin{equation}
v_{(-\D{z})} = v_{\D{z}} + \frac{2 \D{z}}{b_0} \Bigg( \frac{F_v}{\phi_{s, 0}} - w_0 v_0 \Bigg)
\end{equation}

\subsection{Diffusion at the bottom of the sediment}\label{sx:diffusion_bottom}

At sediment depth $z = Z$ only, $v_{(Z+\D{z})}$ falls outside the depth range of the model. However, the model's boundary condition of zero gradients at the bottom dictates that:
\begin{equation}\label{eq:bottom_boundary_condition}
v_{(Z+\D{z})} = v_{(Z-\D{z})}
\end{equation}
Therefore \eqref{eq:bottom_boundary_condition} is substituted into \eqref{eq:diffusion} to calculate diffusion at $z = Z$ for both solutes and solids.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% I R R I G A T I O N %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Irrigation}\label{sx:irrigation}

Irrigation only affects the solutes, not the solids. Its effect varies with depth throughout the sediment:
\begin{equation}
I(v_z) = \alpha_z \, (v_w - v_z)
\end{equation}
where $\alpha_z$ ($\code{alpha}$ in a$^{-1}$) at the sediment-water interface (i.e. where $z = 0$, denoted $\alpha_0$, $\code{alpha\_0}$) is, following \wtf{where does this equation actually come from?}:
\begin{equation}
\begin{split}
\alpha_0 = & 11 \Bigg[ \mathrm{atan} \Bigg( \frac{5 F_c \cdot 10^2 - 400}{400 \pi} \Bigg) + 0.5 \Bigg] - 0.9 \; + \\
& \frac{20 [\ce{O2}]_w}{[\ce{O2}]_w + 0.01} \cdot \frac{F_c \cdot 10^2}{F_c \cdot 10^2 + 30} \cdot \exp \Bigg(\frac{-[\ce{O2}]_w}{0.01}\Bigg)
\end{split}
\end{equation}
Within the sediment itself:
\begin{equation}
\alpha_z = \alpha_0 \exp [-(z/\lambda_i)^2]
\end{equation}
where $\lambda_i = 0.05$ m ($\code{lambda\_i}$) is the characteristic depth of \citet{archer_model_2002}. \wtf{Should $\lambda_i$ be easily adjustable by the user?} 

\bibliography{RADI}

\end{document}
